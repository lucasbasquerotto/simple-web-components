/*! Built with http://stenciljs.com */
const{h:t}=window.SimpleWebComponents;class e{constructor(){this.count=0,this.amount=4e4,this.intervals=[3e3,6e3],this.items=this.createItems()}updateItems(t){console.log("updateItems",t,(this.items||[]).length),this.scrollItems=t}createItems(){let t=this.count*this.amount+1;this.count++;let e=(this.items||[]).concat(".".repeat(this.amount).split("").map((e,s)=>({name:"item-"+(s+t),text:"Item "+(s+t)})));return console.log("createItems",e.length),e}componentDidLoad(){for(let t of this.intervals||[])setTimeout(()=>this.items=this.createItems(),t)}render(){return t("div",null,"Hello, World! I'm ",this.first," ",this.last,t("br",null),t("sp-virtual-scroll",{items:this.items,onUpdate:t=>this.updateItems(t),onVirtualChange:t=>console.log("onVirtualChange",t),onStart:t=>console.log("onStart",t),onEnd:t=>console.log("onEnd",t),parentScroll:this.el,buffer:10},(this.scrollItems||[]).map(e=>t("div",{class:e.name,style:{width:"100%"}},t("div",{style:{width:"100%"}},e.text),e.text.split("").map(e=>t("div",{style:{width:"100%"}},"|",e,"|"))))),"Hello, World! I'm ",this.first," ",this.last,t("br",null))}static get is(){return"my-component"}static get encapsulation(){return"shadow"}static get properties(){return{el:{elementRef:!0},first:{type:String,attr:"first"},items:{state:!0},last:{type:String,attr:"last"},scrollItems:{state:!0}}}static get style(){return":host{display:block;position:relative;height:100%;overflow-y:auto}"}}class s{constructor(){this.items=[],this.buffer=0,this.scrollAnimationTime=1500,this.cumulativeHeights=[],this.showAmountLoop=new Set,this.totalScrollHeight=-1,this.lastTopPadding=-1,console.log("virtual-scroll")}componentWillLoad(){console.log("componentWillLoad"),this.addParentEventHandlers(this.parentScroll||this.el)}componentDidLoad(){console.log("componentDidLoad"),this.refresh()}componentDidUnload(){this.removeParentEventHandlers()}componentWillUpdate(){console.log("componentWillUpdate"),this.refresh()}refresh(t=!1){window.requestAnimationFrame(()=>this.calculateItems(t))}addParentEventHandlers(t){if(this.removeParentEventHandlers(),console.log("parentScroll"),t){const e=()=>this.refresh();t.addEventListener("scroll",e),this.disposeScrollHandler=(()=>t.removeEventListener("scroll",e))}}removeParentEventHandlers(){this.disposeScrollHandler&&(this.disposeScrollHandler(),this.disposeScrollHandler=void 0)}getContent(){return this.el.shadowRoot.querySelector(".scrollable-content")}getShimElement(){return this.el.shadowRoot.querySelector(".total-padding")}calculateItems(t=!1){let{start:e=0,startBuffer:s=0,end:l=0,endBuffer:o=0}=this.calculateValues();if(e!==this.previousStart||l!==this.previousEnd||!0===t){let t=this.items||[];this.viewPortItems=t.slice(s,o),this.onUpdate&&this.onUpdate(this.viewPortItems),console.log("slice",e,l,s,o),e!==this.previousStart&&0===e&&this.onStart&&this.onStart({start:e,end:l}),l!==this.previousEnd&&l===t.length-1&&this.onEnd&&this.onEnd({start:e,end:l}),this.previousStart=e,this.previousStartBuffer=s,this.previousEnd=l;const i=l-e;if(!this.showAmountLoop.has(i))return this.showAmountLoop.add(i),this.refresh()}this.showAmountLoop.clear()}calculateValues(){let t=this.parentScroll||this.el,e=t.scrollTop,s=this.el.children,l=(this.items||[]).length,o=this.parentScroll?this.el.offsetTop:0,i=Math.max(0,(this.totalScrollHeight||0)-o),r=Math.max(0,e-o),n=t.clientHeight||0,a=0,h=0,c=0;if(s&&s.length){let t=this.previousStartBuffer||0,e=t,o=this.cumulativeHeights||[],i=o.length,m=0;if(i<e){i>0&&(m=o[i-1]);for(let t=i;t<e;t++)m+=c,o[t]=m;i=o.length}e&&(m=o[e-1]),console.log("current0",e,t);for(let t of Array.from(s))m+=t.getBoundingClientRect().height||c,o[e]=m,e++;for(c=Math.max(m/e,1),console.log("current1",e);r+n>m&&e<l;)m+=c,o[e]=m,e++;console.log("cumulativeHeight",m,o.length,e),this.cumulativeHeights=o.slice(0,e),i=o.length;let u=0,d=0,p=0;for(;u<i&&(d=p,!((p=o[u])>=r));)u++;for(a=u+(r-d)/(p-d);u<i&&(d=p,!((p=o[u])>=r+n));)u++;let g=u+(r+n-d)/(p-d);h=Math.ceil(g-a)}h=Math.max(h,0);let m=Math.max(0,this.buffer||0);l&&!h&&(h=Math.max(m,2));let u=Math.min(Math.ceil(a)+h,l),d=Math.min(u,Math.floor(a));d=Math.max(0,d||0),d=Math.min(d,l);let p=Math.min(d+h,l),g=d-m-1;g=Math.max(0,g);let f=p+m+1;f=Math.min(f,l);let v=this.cumulativeHeights[g-1]||0;if(v!==this.lastTopPadding){let t=this.getContent();t.style.transform=`translateY(${v}px)`,t.style.webkitTransform=`translateY(${v}px)`,this.lastTopPadding=v}i=c*l;const S=Math.max(0,i+o);return S!==this.totalScrollHeight&&(this.getShimElement().style.height=`${i}px`,this.totalScrollHeight=i,console.log("totalScrollHeight",S,i,l)),console.log("calc",d,g,p,f,h,r,i),{start:d,startBuffer:g,end:p,endBuffer:f,showCount:h}}render(){return[t("div",{class:"total-padding"}),t("div",{class:"scrollable-content"},t("slot",null))]}static get is(){return"sp-virtual-scroll"}static get encapsulation(){return"shadow"}static get properties(){return{buffer:{type:Number,attr:"buffer"},el:{elementRef:!0},items:{type:"Any",attr:"items"},onEnd:{type:"Any",attr:"on-end"},onStart:{type:"Any",attr:"on-start"},onUpdate:{type:"Any",attr:"on-update"},onVirtualChange:{type:"Any",attr:"on-virtual-change"},parentScroll:{type:"Any",attr:"parent-scroll"},scrollAnimationTime:{type:Number,attr:"scroll-animation-time"}}}static get style(){return":host{overflow:hidden;overflow-y:hidden;position:relative;display:block;-webkit-overflow-scrolling:touch}.scrollable-content{top:0;left:0;width:100%;height:100%;position:absolute}.total-padding{width:1px;opacity:0}"}}export{e as MyComponent,s as SpVirtualScroll};